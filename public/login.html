<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - BerganCo SEO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Apple Design System - Dark Mode */
    :root {
      --color-bg-primary: #1C1C1E;
      --color-bg-secondary: #2C2C2E;
      --color-bg-tertiary: #3A3A3C;
      --color-label-primary: #FFFFFF;
      --color-label-secondary: #E5E5EA;
      --color-label-tertiary: #98989D;
      --color-separator: #48484A;
      --color-blue: #0A84FF;
      --color-red: #FF453A;
      
      --spacing-2: 8px;
      --spacing-4: 16px;
      --spacing-6: 24px;
      --font-body: 17px;
      --font-footnote: 13px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
      background: var(--color-bg-primary);
      color: var(--color-label-primary);
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    
    .login-container {
      width: 100%;
      max-width: 400px;
      padding: var(--spacing-6);
    }
    
    .login-card {
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-separator);
      border-radius: 16px;
      padding: var(--spacing-6);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: var(--spacing-4);
      margin-bottom: var(--spacing-6);
    }
    
    .logo-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--color-blue);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 24px;
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--color-label-primary);
    }
    
    .form-group {
      margin-bottom: var(--spacing-4);
    }
    
    .form-label {
      display: block;
      font-size: var(--font-footnote);
      font-weight: 500;
      color: var(--color-label-secondary);
      margin-bottom: var(--spacing-2);
    }
    
    .form-input {
      width: 100%;
      padding: var(--spacing-3);
      background: var(--color-bg-tertiary);
      border: 1px solid var(--color-separator);
      border-radius: 8px;
      color: var(--color-label-primary);
      font-size: var(--font-body);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .form-input:focus {
      border-color: var(--color-blue);
      box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
    }
    
    .btn-primary {
      width: 100%;
      padding: var(--spacing-3);
      background: var(--color-blue);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: var(--font-body);
      font-weight: 500;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .btn-primary:hover:not(:disabled) {
      opacity: 0.85;
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .error-message {
      padding: var(--spacing-3);
      background: rgba(255, 69, 58, 0.1);
      border: 1px solid rgba(255, 69, 58, 0.3);
      border-radius: 8px;
      color: var(--color-red);
      font-size: var(--font-footnote);
      margin-bottom: var(--spacing-4);
      display: none;
    }
    
    .error-message.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-card">
      <div class="logo">
        <div class="logo-icon">B</div>
        <div class="logo-text">BerganCo</div>
      </div>
      
      <h1 style="font-size: 28px; font-weight: 700; margin-bottom: var(--spacing-2);">Welcome Back</h1>
      <p style="font-size: var(--font-footnote); color: var(--color-label-tertiary); margin-bottom: var(--spacing-6);">
        Sign in to access your SEO dashboard
      </p>
      
      <div class="error-message" id="errorMessage"></div>
      
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label" for="email">Email</label>
          <input 
            type="email" 
            id="email" 
            class="form-input" 
            required 
            autocomplete="email"
            placeholder="your@email.com"
          />
        </div>
        
        <div class="form-group">
          <label class="form-label" for="password">Password</label>
          <input 
            type="password" 
            id="password" 
            class="form-input" 
            required 
            autocomplete="current-password"
            placeholder="Enter your password"
          />
        </div>
        
        <button type="submit" class="btn-primary" id="loginBtn">
          Sign In
        </button>
      </form>
    </div>
  </div>

  <script>
    async function handleLogin(event) {
      event.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const loginBtn = document.getElementById('loginBtn');
      const errorDiv = document.getElementById('errorMessage');
      
      loginBtn.disabled = true;
      loginBtn.textContent = 'Signing in...';
      errorDiv.classList.remove('show');
      
      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password }),
          credentials: 'include'
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Login failed');
        }
        
        // Redirect based on role
        if (data.user.role === 'CLIENT') {
          window.location.href = '/';
        } else {
          window.location.href = '/employee.html';
        }
      } catch (error) {
        errorDiv.textContent = error.message || 'Invalid email or password';
        errorDiv.classList.add('show');
        loginBtn.disabled = false;
        loginBtn.textContent = 'Sign In';
      }
    }
    
    // Check if already logged in
    async function checkAuth() {
      try {
        const response = await fetch('/api/auth/me', { credentials: 'include' });
        if (response.ok) {
          const data = await response.json();
          if (data.user) {
            if (data.user.role === 'CLIENT') {
              window.location.href = '/';
            } else {
              window.location.href = '/employee.html';
            }
          }
        }
      } catch (error) {
        // Not logged in, show login form
      }
    }
    
    checkAuth();
  </script>
</body>
</html>
